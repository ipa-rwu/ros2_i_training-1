<!DOCTYPE html>
<html>

<head>
  <title>Template</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="../../common/css/rostraining_slides.css">
</head>

<body>
  <textarea id="source">

layout: true
<!-- <div class="header"><img src="https://rosin-project.eu/wp-content/uploads/rosin_ack_logo_wide.png" style="background-color:transparent"/></div> -->
<div class="footer"><img src="https://www.ipa.fraunhofer.de/content/dam/ipa/ipa.svg" /><p>&copy; Fraunhofer IPA</p></div>
<div class="triangle"></div>



---
class: center, middle
name: main_title

# ROS 2 Training
### ROS 2 Filesystem

---

<!-- ROS as a meta-operating system, since it offers not only tools and libraries but even OS-like functions, such as hardware abstraction, package management, and a developer toolchain. Like a real operating system, ROS files are organized on the hard disk in a particular manner, -->

## Overview

- What is a package?

- How does the structure of workspace look like?

![img](../static/workspace_structure.png)

- How to create workspace and packages?

---
<!-- A  workspace is a folder where you modify, build, and install  packages -->

## Package

- The software in ROS 2 is organized into **packages**

- The smallest build part in ROS 2

- Dedicated to one functionality, e.g. :
  - Hardware driver
  - Algorithm
  - Visualization tool
  - Library ...

- Packages can be grouped to metapackages (e.g [navigation2](https://github.com/ros-planning/navigation2/blob/main/navigation2/))
  - references one or more related packages
  - only contain execution dependencies
  - beneficial for release and version control

  <!-- Metapackages can still exist as regular packages that only contain runtime dependencies. When migrating metapackages from ROS 1, simply remove the <metapackage /> tag in your package manifest. -->

---
## Package install options

| Debian Package | Source Repositories |
| ---------------| ------------------- |
| Automatic installation | "Latest" code |
| Stable versions | Manual compilation |
| Prebuilt binaries | Allows code adjustments |

---

## Package installation (Debian)

- Debian:

    ```
    $ sudo apt install ros-<distro>-package-name
                          ROS         ROS
                    distribution package name
    ```

    example: ``$ sudo apt install ros-humble-nav2-core``

    **!** package_name: **nav2_core** --> install:ros-humble-**nav2-core**
- Automatic installation
  - Location : /opt/ros/`<distro>`/...
  - installs all required dependencies

---
<!--underscore-->

## Package installation (Source)

- Download from source (usually git):
  - Do it in your source space (e.g. ~/devel_ws/src):
   `$ git clone github_link`

   - example: `$ git clone https://github.com/ros2/examples.git -b humble `

- Install all dependencies of package(s)

  - **rosdep** :  download and install dependencies required by ROS packages.

    ```bash
    $ rosdep install --from-paths src --ignore-src --rosdistro humble -y
    ```

- Manage multiple version-control packages: vcstool
    - A version control system (VCS) tool
    - A command-line tool to make working with multiple repositories easier.
    For example: in your workspace(e.g. ~/devel_ws):

    ```bash
    $ wget https://raw.githubusercontent.com/ROBOTIS-GIT/turtlebot3/humble-devel/turtlebot3.repos

    $ vcs import src < turtlebot3.repos
    ```

<!-- - Manual compilation via __colcon__ (explain later) -->


<!-- ## Package content
### Python package
- `package.xml` -  containing meta information about the package
- `setup.py` - containing instructions for how to install the package
- `setup.cfg` - is required when a package has executables
-->

<!-- setup.cfg  ros2 run can find them
https://docs.ros.org/en/humble/Tutorials/Creating-Your-First-ROS2-Package.html -->

---

## Package content - Folder structure

<!-- name: two_columns -->

- Python package

`$ ros2 pkg create --build-type ament_python --dependencies [deps] --node-name my_node my_package`
.cols[
.fifty[

<img src="../static/python_package_2.png" alt="python_package_2" style="width:500px" class="image-center"/>

  ]

.fifty[
  Files:

  * setup.cfg: tell setuptools to put your executables in lib
  * setup.py: the build script for setuptools

  ]
]

---

## Package content - Folder structure

- CMake package

`$ ros2 pkg create --build-type ament_cmake --dependencies [deps] --node-name my_node my_package `

![img](../static/cmake_package.png)

---
### Package content - `package.xml`
![image](../static/packagexml.png)

---

### Package content - `package.xml`
- Meta information about the package
- Lists dependencies of a package

![image](../static/package_detial.png)



---

### Package content - `package.xml`

#### Dependencies

- Dependencies can be __Other ROS packages__ and __System libraries__ (e.g. `Boost`)

- Dependencies:
  - `<buildtool_depend>`: Required for build tools

  - `<exec_depend>`: Required at execution-time (e.g. Python script)

  - `<build_depend>`: Required for building (e.g. rclcpp, ament_cmake)

  - `<test_depend>` : Required for running unit tests

  - `<build_export_depend>` : If exported header dependes on other ones

  - `<depend>` : All-in-one (`<build_depend>`, `<build_export_depend>` and `<exec_depend>`)

---

### Package content - `setup.py` (Python)
Example (**turtlebot_teleop** package):
package path: ~/devel_src/src/turtlebot/turtlebot_teleop



.cols[
  .fifty[
  ![image](../static/setuppy.png)
  ]

  .fifty[
    ```
    setup(
      ...

      entry_points={
          'console_scripts': [
              'teleop_keyboard =
              turtlebot3_teleop.script.teleop_keyboard:main'
          ],
      },
    )
    ```
  - install the executable **teleop_keyboard** to
`devel_ws/install/turtlebot3_teleop/lib/
turtlebot3_teleop/`

    ]
]


---

### Package content - CMakeLists.txt (CMake package)
Example:
![image](../static/cmakefile.png)

- Defines build rules. For example:

    * Declare compilation for executables

    * How to resolve header files and library references
- Mostly CMake, plus ament-specific ones

---

CMakeLists.txt Example:

![image](../static/cmakefile_detail.png)

---

### Colcon - a universal build tool

- Build system: Operates on a single package
- Build tool: Operates on a set of packages

<img src=../static/colcon.png alt="drawing" width="500"/>


Example:

```
# saves you from having to rebuild every time you tweak python scripts
$ colcon build --symlink-install
# builds the package you want
$ colcon build --packages-up-to  <name-of-pkg>
```
**Helpful documentation: https://colcon.readthedocs.io/en/released/user/quick-start.html**

---

### Lint tools

Lint tools : Static checking of Python or C++ source code for errors and standards compliance.

- For Python package

  - package.xml
 ```
 <test_depend>ament_copyright</test_depend>
 <test_depend>ament_flake8</test_depend>
 <test_depend>ament_pep257</test_depend>
 ```
<!--https://github.com/ament/ament_lint
https://docs.ros.org/en/humble/Guides/Ament-CMake-Documentation.html#linting -->

- For CMake package
  - package.xml
 ```
 <test_depend>ament_lint_auto</test_depend>
 <test_depend>ament_lint_common</test_depend>
 ```

`ament_lint_auto`: ament_cmake_copyright, ament_cmake_cppcheck,ament_cmake_flake8, ament_cmake_lint_cmake, ament_cmake_pep257, ament_xmllint
`ament_lint_common`: ament_clang_format, ament_clang_tidy, ament_cmake_clang_format, ament_cmake_clang_tidy

---

## Workspace

- A directory containing ROS 2 packages with a particular structure

- Structure

![img](../static/workspace_structure.png)

*__Colcon__* creats __build/__ __install/__ __log/__ as peers of the src/

---

## Workspace

#### Used for Development

* Source Space (`src/`):
        Contains the source version of packages
* Build Space (`build/`):
        Where CMake is invoked and generates artifacts

#### Ready for Installation

* Install Space (`install/`):
        Self-contained package ready for release
* Package-structure like in /opt/ros/`<distro>`

---

### Environment setup files

- Setup file generated at initialization of a workspace: setup.bash, setup.zsh ...

- Source your ROS 2 installation workspace before using ROS 2

    ``$ source /opt/ros/<distro>/setup.bash ``

    <!-- Why? ROS relies on the notion of combining spaces using the shell environment. -->

- Source your workspace:
    ``$ source <ws-path>/install/setup.bash ``

** ---> ROS can find and use any resource inside the ROS environment**

---

### Compile workspace Example:

* Go to your workspace:
    `$ cd ~/devel_ws`
*   Source ROS 2 installation workspace
    `$ source /opt/ros/humble/setup.bash `
* Install all dependencies of package(s)
    `rosdep` :  download and install dependencies required by ROS packages.
    - For the first time, you need to run:
        ```bash
        $ sudo rosdep init
        $ rosdep update
        ```
* Install all dependencies of package(s)
    * Then you can use:
```bash
$ rosdep install --from-paths src --ignore-src --rosdistro humble -y
```

* Compile the workspace
```bash
$ colcon build --symlink-install
```

- After `colcon build` in your workspace, source ROS env :
`$ source <ws-path>/install/setup.bash`
(including /opt/ros/`<distro>`/setup.bash)

---

## Any Questions?
![img](../static/questions.jpeg)


</textarea>
  <script src="https://remarkjs.com/downloads/remark-latest.min.js">
  </script>
  <script>
    var slideshow = remark.create({ ratio: "16:9" });
  </script>
</body>

</html>
